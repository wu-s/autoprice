<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Auto Price Inquiry</title>
    <link rel="stylesheet" href="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="http://cdn.static.runoob.com/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<body>

<ul id="myTab" class="nav nav-tabs">
    <li class="active">
        <a href="#home" data-toggle="tab">
            平均价格变化
        </a>
    </li>
    <li><a href="#ios" data-toggle="tab" id="data-inquiry">上次数据获取结果下载</a></li>
</ul>
<div id="myTabContent" class="tab-content">
    <div class="tab-pane fade in active" id="home">
        <table class="table table-bordered" id="state-price-table">
            <thead>
            <tr>
                <th>州</th>
            </tr>
            </thead>
            </tbody>
        </table>
    </div>
    <div class="tab-pane fade" id="ios">
        <!--
        <div class="dropdown" id="state_dropdown">
            <button type="button" class="btn dropdown-toggle" id="dropdownMenu1"
                    data-toggle="dropdown">
                州
                <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1" id="state-dropdown-menu">
            </ul>
        </div>
        -->
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function(){
        $.ajax({
            method: "GET",
            url: "reports.php",
            dataType: 'jsonp',
            success:function(data){
                var states = data.state;
                var price = data.price;
                $.each(price, function(inquiry_time){
                    //echo header
                    $('#state-price-table tr').append('<td>' + inquiry_time +'</td>');
                });

                //echo data
                $.each(states, function(i, state){
                    var doms = ['<tr><td>'+ state +'</td>'];
                    $.each(price, function(inquiry_time){
                        var tmp = '';
                        if(price[inquiry_time][state]){
                            tmp = '<td>' + price[inquiry_time][state]['avg_price'] + '</td>';
                        }else{
                            tmp = '<td>-</td>';
                        }
                        doms.push(tmp);
                    });
                    doms.push('</tr>');
                    var html = doms.join('');
                    $('#state-price-table').append(html);

                    $('#state-dropdown-menu').append('<li role="presentation"><a role="menuitem" tabindex="-1" href="#">'+ state +'</a></li>');

                    $('#data-inquiry').click(function(){
                        window.location.href="download.php";
                    });
                });
            }
        });
    });
</script>


</body>
</html>